language: java
env:
  - jdk_switcher=/opt/jdk_switcher/jdk_switcher.sh

cache:
  directories:
  - $HOME/.m2

services:
  - xvfb

addons:
  chrome: stable
before_install:
  - sudo apt-get -qq update || echo no sudo apt-get
  - sudo apt-get install -y libgnome2-0
  - sudo apt-get install -y libwebkitgtk-3.0-0 || echo no sudo apt-get
  - wget https://github.com/sormuras/bach/raw/releases/11/install-jdk.sh
  - chmod +x $TRAVIS_BUILD_DIR/install-jdk.sh
  # start your web application and listen on `localhost`
  - google-chrome-stable --headless --disable-gpu --remote-debugging-port=9222 http://localhost &
script:
  - dir
  - cd ./automatonosgi
  - jdk_switcher use openjdk11
#  - export JAVA_HOME=$HOME/openjdk11
  - mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -ntp
  - mvn test org.jacoco:jacoco-maven-plugin:0.8.2:report -B -ntp
  - cd ..
  - cd ./generex
  - mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -ntp
  - mvn test org.jacoco:jacoco-maven-plugin:0.8.2:report -B -ntp
  - cd ..
  - cd ./js
  - mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -ntp
  - mvn test org.jacoco:jacoco-maven-plugin:0.8.2:report -B -ntp
  - cd ..
  - cd ./client
  - mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -ntp
  - mvn test org.jacoco:jacoco-maven-plugin:0.8.2:report -B -ntp
  - cd ..
  - cd ./client-web
  - mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -ntp
  - mvn test org.jacoco:jacoco-maven-plugin:0.8.2:report -B -ntp
  - cd ..
  - cd ./client-netbeans
  - mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -ntp
  - mvn test org.jacoco:jacoco-maven-plugin:0.8.2:report -B -ntp
  - cd ..
  -  cd ./client-idea
  - jdk_switcher use openjdk17
#  - export JAVA_HOME=$HOME/openjdk11
  - mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -ntp
  - mvn test org.jacoco:jacoco-maven-plugin:0.8.2:report -B -ntp
  - cd ..
after_success:
  - mvn coveralls:report -B -ntp
